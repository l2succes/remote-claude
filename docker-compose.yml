# Docker Compose for Local Development
#
# Usage:
#   docker-compose up -d        # Start services
#   docker-compose logs -f      # View logs
#   docker-compose down         # Stop services
#
# Environment:
#   Copy .env.example to .env and configure your API keys

services:
  # Agent Server - runs Claude Agent SDK
  agent:
    build:
      context: .
      dockerfile: container/Dockerfile
    container_name: remote-claude-agent
    ports:
      - "8080:8080"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - PORT=8080
      - HOST=0.0.0.0
      - WORKING_DIR=/workspace
      - LOG_LEVEL=${LOG_LEVEL:-info}
    volumes:
      # Mount workspace for file access
      - ./workspace:/workspace
      # Mount MCP configs
      - ./container/mcps:/app/mcps:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    networks:
      - remote-claude

  # Development mode - use local source code
  agent-dev:
    build:
      context: .
      dockerfile: container/Dockerfile.dev
    container_name: remote-claude-agent-dev
    ports:
      - "8081:8080"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - PORT=8080
      - HOST=0.0.0.0
      - WORKING_DIR=/workspace
      - LOG_LEVEL=debug
    volumes:
      - ./workspace:/workspace
      - ./packages/shared/src:/app/packages/shared/src:ro
      - ./services/agent-server/src:/app/services/agent-server/src:ro
      - ./container/mcps:/app/mcps:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    networks:
      - remote-claude
    profiles:
      - dev

networks:
  remote-claude:
    driver: bridge

volumes:
  workspace:
